

# ğŸ§© Apex Future æ–¹æ³•å®Œå…¨å…¥é—¨

---

## ğŸ¯ ä¸€å¥è¯ç†è§£ Future æ–¹æ³•

> **Future æ–¹æ³•** = â€œæ‰“ä¸ªç”µè¯è®©åˆ«äººå¸®ä½ åšäº‹â€

ä½ å†™ä»£ç çš„æ—¶å€™å‘Šè¯‰ Salesforceï¼š

> â€œè¿™ä»¶äº‹æˆ‘ä¸æƒ³ç°åœ¨åšï¼Œè¯·åå°ç¨åå¸®æˆ‘åšã€‚â€

ç³»ç»Ÿå°±ä¼šï¼š

* æŠŠè¿™ä¸ªä»»åŠ¡æ”¾è¿›ã€Œæœªæ¥é˜Ÿåˆ—ï¼ˆFuture Queueï¼‰ã€ï¼›
* ç©ºé—²æ—¶è‡ªåŠ¨æ‰§è¡Œï¼›
* ä½ ä¸éœ€è¦ç­‰å¾…å®ƒå®Œæˆã€‚

---

## ğŸ§± ä¸€ã€ç±»æ¯”ç†è§£ï¼šåŒæ­¥ vs å¼‚æ­¥

| ç±»å‹        | æ¯”å–»              | ç‰¹ç‚¹          |
| --------- | --------------- | ----------- |
| æ™®é€šæ–¹æ³•      | è‡ªå·±åœ¨åšé¥­ï¼Œå¿…é¡»ç­‰ç…®å®Œæ‰èƒ½æ´—ç¢— | åŒæ­¥æ‰§è¡Œï¼Œç«‹åˆ»è¿è¡Œ   |
| Future æ–¹æ³• | è¯·åˆ«äººå¸®ä½ ç…®é¥­ï¼Œä½ å»æ´—ç¢—    | å¼‚æ­¥æ‰§è¡Œï¼Œä¸ç”¨ç­‰å®ƒå®Œæˆ |

---

## âœ¨ äºŒã€æœ€ç®€å•çš„ Future æ–¹æ³•ä¾‹å­

```apex
public class MyFutureExample {
    @future
    public static void sendMessage() {
        System.debug('ğŸ“© åå°å¼€å§‹å‘é€æ¶ˆæ¯...');
    }
}

// è°ƒç”¨æ–¹å¼ï¼ˆåœ¨ä»»ä½•ç±»æˆ–åŒ¿åçª—å£é‡Œï¼‰ï¼š
MyFutureExample.sendMessage();
```

ğŸ“˜ è¯´æ˜ï¼š

* `@future`ï¼šå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªæ–¹æ³•æ˜¯â€œå¼‚æ­¥æ‰§è¡Œâ€çš„ï¼›
* `static`ï¼šå¿…é¡»æ˜¯é™æ€çš„ï¼›
* æ— éœ€ç«‹å³ç­‰å¾…ç»“æœï¼Œç³»ç»Ÿç¨åæ‰§è¡Œã€‚

---

## ğŸ§© ä¸‰ã€ä¸ºä»€ä¹ˆè¦ç”¨ Futureï¼Ÿ

ç°å®åœºæ™¯ä¸­ï¼Œ**è§¦å‘å™¨ã€Flow æˆ–åŒæ­¥é€»è¾‘ä¸­ä¸å…è®¸å¤ªè€—æ—¶çš„æ“ä½œ**ã€‚
æ¯”å¦‚ï¼š

* å‘å¤–éƒ¨ç³»ç»Ÿå‘ HTTP è¯·æ±‚ï¼›
* å‘é€å¤§é‡é‚®ä»¶ï¼›
* æ›´æ–°å¾ˆå¤šè®°å½•ï¼›
* è°ƒç”¨ Web Serviceã€‚

è¿™ç§æƒ…å†µå°±å¯ä»¥ç”¨ `@future` å¼‚æ­¥æ‰§è¡Œï¼Œé¿å…è¶…æ—¶ã€‚

---

### âœ¨ ä»£ç ä¾‹å­ï¼šè§¦å‘å™¨ä¸­å¼‚æ­¥è°ƒç”¨å¤–éƒ¨æ¥å£

```apex
trigger AccountTrigger on Account (after insert) {
    for (Account acc : Trigger.new) {
        ExternalCallout.sendToApi(acc.Id);
    }
}

public class ExternalCallout {
    @future(callout=true)
    public static void sendToApi(Id accountId) {
        // æ¨¡æ‹Ÿè°ƒç”¨å¤–éƒ¨ç³»ç»Ÿ
        HttpRequest req = new HttpRequest();
        req.setEndpoint('https://example.com/api');
        req.setMethod('POST');
        req.setBody('AccountId=' + accountId);
        Http http = new Http();
        HttpResponse res = http.send(req);
        System.debug('âœ… å¤–éƒ¨æ¥å£å“åº”ï¼š' + res.getStatus());
    }
}
```

---

## ğŸ§® å››ã€Future æ–¹æ³•çš„å‚æ•°é™åˆ¶

Future æ–¹æ³•æœ‰ä¸€äº›**ä¸¥æ ¼é™åˆ¶**ï¼Œå› ä¸ºå®ƒæ˜¯å¼‚æ­¥çš„ã€‚
ç³»ç»Ÿè¦èƒ½â€œåºåˆ—åŒ–å‚æ•°â€ï¼Œæ‰èƒ½ä¿å­˜å¹¶ç¨åæ‰§è¡Œã€‚

| é™åˆ¶é¡¹    | è¯´æ˜                                               |
| ------ | ------------------------------------------------ |
| å‚æ•°ç±»å‹   | åªèƒ½æ˜¯**åŸºæœ¬ç±»å‹**ã€**sObject ID**ã€**åŸºæœ¬ç±»å‹çš„é›†åˆï¼ˆList/Setï¼‰** |
| âŒ ä¸å¯   | ä¸èƒ½ç›´æ¥ä¼ è‡ªå®šä¹‰å¯¹è±¡æˆ–å¤æ‚ç±»å‹                                  |
| è¿”å›å€¼    | å¿…é¡»æ˜¯ `void`ï¼ˆä¸èƒ½æœ‰è¿”å›å€¼ï¼‰                               |
| static | æ–¹æ³•å¿…é¡»æ˜¯ `static`                                   |
| è°ƒç”¨æ¬¡æ•°   | ä¸€æ¬¡äº‹åŠ¡ä¸­æœ€å¤šè°ƒç”¨ 50 ä¸ª Future æ–¹æ³•                         |

---

### âœ¨ ä¾‹å­ï¼šå¸¦å‚æ•°çš„ Future æ–¹æ³•

```apex
public class MyFutureParam {
    @future
    public static void updateAccountName(List<Id> accIds) {
        List<Account> accs = [SELECT Id, Name FROM Account WHERE Id IN :accIds];
        for (Account a : accs) {
            a.Name += 'ï¼ˆæ›´æ–°ï¼‰';
        }
        update accs;
        System.debug('âœ… å¼‚æ­¥æ›´æ–°å®Œæˆ');
    }
}

// è°ƒç”¨ï¼š
List<Id> ids = new List<Id>{'001xxxxxxxxxxxx', '001yyyyyyyyyyyy'};
MyFutureParam.updateAccountName(ids);
```

---

## ğŸ§  äº”ã€Future çš„æ‰§è¡Œç‰¹ç‚¹

| ç‰¹æ€§      | è¯´æ˜                         |
| ------- | -------------------------- |
| ğŸ” å¼‚æ­¥æ‰§è¡Œ | ä¸ä¼šç«‹å³è¿è¡Œï¼Œç³»ç»Ÿç¨åå¤„ç†              |
| ğŸ’¾ ç‹¬ç«‹äº‹åŠ¡ | ä¸åŸå§‹äº‹åŠ¡åˆ†å¼€æ‰§è¡Œï¼ˆæ•°æ®åº“æäº¤åå†æ‰§è¡Œï¼‰       |
| ğŸ•’ æ‰§è¡Œæ—¶é—´ | é€šå¸¸å‡ ç§’å†…ï¼Œä½†æ— æ³•ä¿è¯é¡ºåºæˆ–å‡†ç¡®æ—¶é—´         |
| ğŸ§© å¯å¹¶å‘  | ç³»ç»Ÿå¯åŒæ—¶è¿è¡Œå¤šä¸ª Future ä»»åŠ¡        |
| ğŸ§­ å¯ç›‘æ§  | å¯åœ¨ Setup â†’ Apex Jobs ä¸­æŸ¥çœ‹çŠ¶æ€ |

---

## âš™ï¸ å…­ã€@future(callout=true) ç”¨æ³•

å¦‚æœä½ çš„ Future æ–¹æ³•è¦**è°ƒç”¨å¤–éƒ¨æ¥å£ï¼ˆHTTP è¯·æ±‚ï¼‰**ï¼Œ
å¿…é¡»åŠ ä¸Š `callout=true`ã€‚

å¦åˆ™ä¼šæŠ¥é”™ï¼š

> `System.CalloutException: Callout not allowed from this future method.`

### âœ… æ­£ç¡®ç¤ºä¾‹ï¼š

```apex
@future(callout=true)
public static void sendToExternalSystem(String name) {
    Http h = new Http();
    HttpRequest req = new HttpRequest();
    req.setEndpoint('https://api.example.com');
    req.setMethod('POST');
    req.setBody('Name=' + name);
    h.send(req);
}
```

---

## âš ï¸ ä¸ƒã€å¸¸è§é”™è¯¯ä¸æ³¨æ„äº‹é¡¹

| é”™è¯¯æƒ…å¢ƒ                     | åŸå›                     | è§£å†³æ–¹æ³•                          |
| ------------------------ | --------------------- | ----------------------------- |
| âŒ åœ¨ @future é‡Œå†è°ƒç”¨ @future | ä¸å…è®¸åµŒå¥—å¼‚æ­¥               | ç”¨ Queueable ä»£æ›¿                |
| âŒ ä¼ é€’å¤æ‚å¯¹è±¡                 | Future å‚æ•°å¿…é¡»å¯åºåˆ—åŒ–       | æ”¹æˆä¼  IDï¼Œå†åœ¨æ–¹æ³•å†…æŸ¥è¯¢                |
| âŒ éœ€è¦è¿”å›å€¼                  | Future æ— æ³•è¿”å›ä»»ä½•æ•°æ®       | æ”¹ç”¨ Queueable æˆ– Platform Event |
| âŒ å¤ªå¤šè°ƒç”¨                   | ä¸€æ¬¡äº‹åŠ¡æœ€å¤š 50 ä¸ª Future è°ƒç”¨ | åˆå¹¶é€»è¾‘æˆ–æ”¹ç”¨ Batch/Queueable       |

---

## ğŸ§© å…«ã€Future ä¸ Queueable çš„æ¯”è¾ƒ

| ç‰¹æ€§    | Future            | Queueable          |
| ----- | ----------------- | ------------------ |
| è¯­æ³•    | `@future` æ–¹æ³•      | ç±»å®ç° `Queueable` æ¥å£ |
| å¯ä¼ å¯¹è±¡  | âŒ åªèƒ½åŸºæœ¬ç±»å‹          | âœ… å¯ä»¥ä¼ å¤æ‚å¯¹è±¡          |
| å¯é“¾å¼è°ƒç”¨ | âŒ ä¸è¡Œ              | âœ… å¯ä»¥æ¥åŠ›æ‰§è¡Œ           |
| å¯ç›‘æ§çŠ¶æ€ | âŒ åªèƒ½åœ¨ Apex Jobs çœ‹ | âœ… æœ‰ JobId å¯è¿½è¸ª      |
| åµŒå¥—å¼‚æ­¥  | âŒ ä¸å…è®¸             | âœ… å…è®¸ä¸€å±‚åµŒå¥—           |
| é€‚ç”¨åœºæ™¯  | ç®€å•åå°ä»»åŠ¡            | å¤æ‚é€»è¾‘ / å¤šæ­¥éª¤ä»»åŠ¡       |

> **ä¸€å¥è¯åŒºåˆ†**ï¼š
>
> * Future = â€œæ‰“ç”µè¯å«åˆ«äººå¸®å¿™ï¼ˆç®€å•äº‹ï¼‰â€
> * Queueable = â€œå‘ä»»åŠ¡å• + å¸¦è¯¦ç»†æŒ‡ç¤ºï¼ˆå¤æ‚äº‹ï¼‰â€

---

## âœ… ä¹ã€å®Œæ•´èŒƒä¾‹æ€»ç»“

```apex
public class SendEmailFuture {
    // å¼‚æ­¥å‘é€é‚®ä»¶
    @future
    public static void sendEmail(String targetEmail) {
        System.debug('ğŸ“© å¼€å§‹å¼‚æ­¥å‘é€é‚®ä»¶åˆ°ï¼š' + targetEmail);
        // æ¨¡æ‹Ÿé‚®ä»¶é€»è¾‘
        // Messaging.sendEmail(...);
    }
}

// è°ƒç”¨æ–¹å¼
SendEmailFuture.sendEmail('test@example.com');
System.debug('âœ… ä»»åŠ¡å·²æäº¤åå°æ‰§è¡Œ');
```

---

## ğŸ§  åã€æ€»ç»“å£è¯€

```
@future å°±æ˜¯â€œæœªæ¥æ‰§è¡Œçš„é™æ€æ–¹æ³•â€
åªèƒ½ä¼ ç®€å•å‚æ•°
ä¸èƒ½è¿”å›å€¼
ä¸èƒ½åµŒå¥—å¼‚æ­¥
å¯åœ¨åå°é˜Ÿåˆ—æŸ¥çœ‹æ‰§è¡Œæƒ…å†µ
```

---
