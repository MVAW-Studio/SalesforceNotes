# 🧱 Apex 面向对象三大特性（完整版）

> —— 从“生活世界”到“代码世界”的思维转换
> 面向对象的三根支柱：**封装（Encapsulation）**、**继承（Inheritance）**、**多态（Polymorphism）**

---

## 🧩 一、封装（Encapsulation）

> **关键词：**隐藏细节、暴露接口、数据安全

### 💬 比喻：

自动咖啡机 ☕：
你按按钮（接口），就能出咖啡。
你看不到、也不能直接修改内部加热器、泵、管道。

这就是「封装」——
**把内部复杂逻辑藏起来，只给外部安全可控的通道。**

---

### ✅ 代码示例

```apex
public class BankAccount {
    // 🔒 封装的核心：内部数据对外不可直接访问
    private Decimal balance;

    // ✅ 通过安全方法控制访问
    public void deposit(Decimal amount) {
        if (amount > 0) balance += amount;
        else System.debug('❌ 存款金额无效');
    }

    public void withdraw(Decimal amount) {
        if (amount > 0 && amount <= balance) balance -= amount;
        else System.debug('❌ 取款失败');
    }

    public Decimal getBalance() {
        return balance; // 外部只能读取，不能直接改
    }
}
```

```apex
BankAccount acc = new BankAccount();
acc.deposit(500);
acc.withdraw(200);
System.debug(acc.getBalance()); // ✅ 输出 300
```

---

## 🧩 二、继承（Inheritance）

> **关键词：**代码复用、父子关系、`extends`、`super`

### 💬 比喻：

「交通工具」是一个大类 🚗🚲✈️
汽车、自行车都属于交通工具，都有“启动”和“停止”的功能。

但每种交通工具的“启动方式”不同。

---

### ✅ 基础继承示例

```apex
public virtual class Vehicle {
    public String brand;

    public Vehicle(String brandName) {
        brand = brandName;
    }

    public void start() {
        System.debug(brand + ' 交通工具启动');
    }

    public void stop() {
        System.debug(brand + ' 交通工具停止');
    }
}
```

#### 子类继承父类：

```apex
public class Car extends Vehicle {
    public Boolean hasEngine = true;

    // 🔹 使用 super 调用父类构造函数
    public Car(String brandName) {
        super(brandName); // 调用父类 Vehicle(String)
    }

    // 子类新增方法
    public void honk() {
        System.debug(brand + ' 汽车鸣笛 🚗📣');
    }
}
```

---

### 🔹 调用：

```apex
Car c = new Car('Toyota');
c.start();  // ✅ 父类方法
c.honk();   // ✅ 子类方法
c.stop();   // ✅ 父类方法
```

---

### 🧠 父类与子类的属性关系：

| 情况                                | 说明                 |
| --------------------------------- | ------------------ |
| 子类继承父类的 `public` / `protected` 成员 | 可以直接使用             |
| 子类无法访问父类的 `private` 成员            | 必须通过 getter/setter |
| 子类可以拥有与父类同名的字段（但不推荐）              | 会“隐藏”父类字段          |

---

### ⚙️ 示例：父类属性与子类属性同名

```apex
public virtual class Animal {
    public String name = 'Animal';
}

public class Dog extends Animal {
    public String name = 'Dog'; // ⚠️ 隐藏了父类字段

    public void showNames() {
        System.debug('子类name: ' + name);      // Dog
        System.debug('父类name: ' + super.name); // Animal
    }
}
```

```apex
Dog d = new Dog();
d.showNames();
```

🧠 输出：

```
子类name: Dog
父类name: Animal
```

> 💡 `super.name` 表示访问父类的同名属性，`this.name` 或 `name` 表示当前子类的属性。

---

## 🧩 三、多态（Polymorphism）

> **关键词：**相同方法，不同行为；上转型、下转型

### 💬 比喻：

你按下「启动交通工具」按钮 🚀
如果你开的车是汽车 → 发动机轰鸣；
如果你骑的是自行车 → 踩踏板启动；
如果你坐的是飞机 → 引擎喷射。

👉 同样的“动作”，不同的对象有不同的表现。

---

### ✅ 代码示例：

```apex
public virtual class Vehicle {
    public virtual void start() {
        System.debug('🚗 一般交通工具启动');
    }
}

public class Car extends Vehicle {
    public override void start() {
        System.debug('🚙 汽车引擎启动');
    }
}

public class Bicycle extends Vehicle {
    public override void start() {
        System.debug('🚴 自行车用脚启动');
    }
}
```

---

### 🧠 上转型（Upcasting）

> “把子类对象看作父类对象”
> —— 子类 **自动** 转为父类类型，可以统一管理。

```apex
Vehicle v1 = new Car();
Vehicle v2 = new Bicycle();

v1.start(); // 输出 🚙 汽车引擎启动
v2.start(); // 输出 🚴 自行车用脚启动
```

💡 好处：
你可以用一个父类列表，统一管理不同类型的对象：

```apex
List<Vehicle> vehicles = new List<Vehicle>{
    new Car(),
    new Bicycle()
};
for (Vehicle v : vehicles) {
    v.start(); // 每个对象调用自己版本的 start()（多态！）
}
```

---

### 🧠 下转型（Downcasting）

> “把父类对象强制转回子类类型”
> —— 只有当对象原本就是那个子类，才可以成功。

```apex
Vehicle v = new Car(); // ✅ Upcasting
Car c = (Car)v;        // ✅ Downcasting
c.start();             // ✅ 正常执行
```

⚠️ 如果你强制转型为错误类型，会报错：

```apex
Vehicle v = new Bicycle();
Car c = (Car)v; // ❌ 运行时错误
```

---

### ⚙️ 上下转型对比表

| 类型转换             | 写法                       | 是否自动 | 说明             |
| ---------------- | ------------------------ | ---- | -------------- |
| 上转型（Upcasting）   | `Vehicle v = new Car();` | ✅ 自动 | 子类 → 父类（安全）    |
| 下转型（Downcasting） | `Car c = (Car)v;`        | ❌ 手动 | 父类 → 子类（需确认类型） |

---

### ✅ 实战：多态与转型结合

```apex
public virtual class Animal {
    public virtual void speak() {
        System.debug('🐾 动物发出声音');
    }
}

public class Cat extends Animal {
    public override void speak() {
        System.debug('🐱 喵喵叫');
    }

    public void climb() {
        System.debug('🐱 猫在爬树');
    }
}

public class Dog extends Animal {
    public override void speak() {
        System.debug('🐶 汪汪叫');
    }
}
```

#### 调用：

```apex
List<Animal> animals = new List<Animal>{
    new Cat(),
    new Dog()
};

for (Animal a : animals) {
    a.speak(); // 多态：每种动物表现不同
}

// 下转型：判断后执行特定方法
for (Animal a : animals) {
    if (a instanceof Cat) {
        ((Cat)a).climb(); // ✅ 转型后才能调用 Cat 独有方法
    }
}
```

输出：

```
🐱 喵喵叫
🐶 汪汪叫
🐱 猫在爬树
```

---

## 🧩 四、三大特性总结表

| 特性 | 关键字                             | 说明             | 示例比喻           |
| -- | ------------------------------- | -------------- | -------------- |
| 封装 | `private`, `{get; set;}`        | 隐藏内部细节，只暴露必要接口 | 咖啡机按钮          |
| 继承 | `extends`, `super`, `virtual`   | 子类复用父类功能       | “汽车”继承“交通工具”   |
| 多态 | `override`, `virtual`, `(Type)` | 同接口多行为，上转型/下转型 | 不同交通工具“启动”反应不同 |

---

## 🧩 五、完整综合示例

```apex
public virtual class Vehicle {
    public String brand;

    public Vehicle(String brandName) {
        brand = brandName;
    }

    public virtual void start() {
        System.debug(brand + ' 通用交通工具启动');
    }
}

public class Car extends Vehicle {
    public Car(String brandName) {
        super(brandName);
    }

    public override void start() {
        System.debug('🚗 ' + brand + ' 汽车引擎启动');
    }

    public void playMusic() {
        System.debug('🎵 ' + brand + ' 播放音乐');
    }
}

public class Bicycle extends Vehicle {
    public Bicycle(String brandName) {
        super(brandName);
    }

    public override void start() {
        System.debug('🚴 ' + brand + ' 自行车开始骑行');
    }
}

// 调用
List<Vehicle> listV = new List<Vehicle>{
    new Car('Toyota'),
    new Bicycle('Giant')
};

for (Vehicle v : listV) {
    v.start(); // 多态效果
    if (v instanceof Car) {
        ((Car)v).playMusic(); // 下转型后访问子类特有方法
    }
}
```

🧠 输出：

```
🚗 Toyota 汽车引擎启动
🎵 Toyota 播放音乐
🚴 Giant 自行车开始骑行
```

---

## 🧩 六、思维导图总结 🌳

| 概念 | Apex关键词                 | 现实类比       | 核心思维 |
| -- | ----------------------- | ---------- | ---- |
| 封装 | private/public, get/set | 咖啡机只暴露按钮   | 数据安全 |
| 继承 | extends, super          | 交通工具 → 汽车  | 代码复用 |
| 多态 | override, instanceof    | 不同交通工具启动方式 | 灵活扩展 |

---

### ✅ 最后一口总结：

> * **封装** → “我不让你乱碰我内部零件”
> * **继承** → “我从父辈那儿继承了技能”
> * **多态** → “同样的动作，我可以有自己的表现”

